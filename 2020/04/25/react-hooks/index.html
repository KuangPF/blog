<!DOCTYPE html>

<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <link rel="shortcut icon" href="/blog/logo.png">
  <title>React Hooks 讲解 [ 🦄 KuangPF’ blog ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/blog/css/iLiKE.css">
    
  
</head></html>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="/blog/unicorn.svg" class="no-medium-zoom-image"></img>
        </a>
      </div>
      <div class="menu-right">
        
          
          
          
          
          
          
          <a href="/blog">首页</a>
        
          
          
          
          
          
          <a href="https://github.com/KuangPF">Github</a>
        
      </div>
    </div>
</div>
    </div>
    <div class="container">
        
<h1 class="post-title">React Hooks 讲解</h1>
<article class="post markdown-style">
  
  <div class="toc-label">目录</div>
  
  <ol class="ilike-toc"><li class="ilike-toc-item ilike-toc-level-2"><a class="ilike-toc-link" href="#前言"><span class="ilike-toc-text">前言</span></a></li><li class="ilike-toc-item ilike-toc-level-2"><a class="ilike-toc-link" href="#Basic-Hooks"><span class="ilike-toc-text">Basic Hooks</span></a><ol class="ilike-toc-child"><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useState"><span class="ilike-toc-text">useState</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useEffect"><span class="ilike-toc-text">useEffect</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useContext"><span class="ilike-toc-text">useContext</span></a></li></ol></li><li class="ilike-toc-item ilike-toc-level-2"><a class="ilike-toc-link" href="#Additional-Hooks"><span class="ilike-toc-text">Additional Hooks</span></a><ol class="ilike-toc-child"><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useReducer"><span class="ilike-toc-text">useReducer</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useCallback"><span class="ilike-toc-text">useCallback</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useMemo"><span class="ilike-toc-text">useMemo</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useRef"><span class="ilike-toc-text">useRef</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useImperativeHandle"><span class="ilike-toc-text">useImperativeHandle</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useLayoutEffect"><span class="ilike-toc-text">useLayoutEffect</span></a></li><li class="ilike-toc-item ilike-toc-level-3"><a class="ilike-toc-link" href="#useDebugValue"><span class="ilike-toc-text">useDebugValue</span></a></li></ol></li><li class="ilike-toc-item ilike-toc-level-2"><a class="ilike-toc-link" href="#总结"><span class="ilike-toc-text">总结</span></a></li></ol>
  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇文章主要是对 React Hooks 基本的语法进行简单介绍，以及会用一些简单的 demo 来展示 React Hooks 的奇妙之处，部分代码来源 React 社区，所有代码均可在 <a href="https://github.com/KuangPF/react-hooks-demo" target="_blank" rel="noopener">react-hooks-demo</a> 获取。</p>
<h2 id="Basic-Hooks"><a href="#Basic-Hooks" class="headerlink" title="Basic Hooks"></a>Basic Hooks</h2><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><p><code>useState</code> 是为了让 function component 具有 class component <code>state</code> 功能，使用方法如下：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useStateDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setCount(count + 1)</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        click</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p><code>useState</code> 接收一个初始化 <code>state</code> 值的参数，返回值为当前 <code>state</code> 以及更新 <code>state</code> 的函数。<a href="https://kuangpf.com/react-hooks-demo/#/basic/useState" target="_blank" rel="noopener">demo</a></p>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p><code>useEffect</code> 的作用是执行一些副作用代码，比如 api 请求，DOM 元素修改等，它接收一个包含副作用代码的函数，该函数的返回值用于清除副作用。 <code>useEffect</code> 是 UI 已经渲染到屏幕上以后才会执行，因此副作用里面的代码是不会阻碍屏幕的渲染，与类组件相比，使用 <code>useEffect</code> 处理副作用后，屏幕会渲染地更快。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useEffectDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="built_in">window</span>.innerWidth)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleResize = <span class="function"><span class="params">()</span> =&gt;</span> setWidth(<span class="built_in">window</span>.innerWidth)</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, handleResize)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'resize'</span>, handleResize)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;p&gt;the innerWidth is &#123;width&#125;px&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>上述例子监听浏览器窗口大小，当浏览器窗口发生改变时，将浏览器 <code>innerWidth</code> 的值显示在屏幕上。但这个例子存在一个问题：<br>每当浏览器窗口发生改变，会调用 <code>setWidth</code> 从而引起 <code>render</code>，每次 <code>render</code> 后， React 都会清除上一次的 effect，并且运行本次渲染的 effect。相当于每次 <code>render</code> 的时候都会执行一遍 <code>useEffect</code> 中副作用代码。显然我们不希望有这样无效的开销，那么怎么处理呢？<br><code>useEffect</code> 第二个参数接收一个依赖数组，只有当依赖数组中的一项或者多项发生改变时才会重新执行 <code>useEffect</code> 中的副作用代码。那么可以这样修改：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> handleResize = <span class="function"><span class="params">()</span> =&gt;</span> setWidth(<span class="built_in">window</span>.innerWidth)</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, handleResize)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'resize'</span>, handleResize)</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>
<p>当传入一个 <code>[]</code> 时，表示 <code>useEffect</code> 只会执行一次，类似于 <code>componentDidMount</code>，但两者并不完全相等。<a href="https://kuangpf.com/react-hooks-demo/#/basic/useEffect" target="_blank" rel="noopener">demo</a></p>
<h3 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h3><p><code>useContext</code> 是为了在 function 组件中使用类组件的 <a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener">context</a> API，使用方法很简单，首先创建一个 context：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> local = <span class="string">'🇨🇳'</span></span><br><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(local)</span><br></pre></td></tr></table></figure></p>
<p>然后在 <code>useContext</code> hook 使用 context：<a href="https://kuangpf.com/react-hooks-demo/#/basic/useContext" target="_blank" rel="noopener">demo</a></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseContextDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> local = useContext(ThemeContext)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;local: &#123;local&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// render: 🇨🇳</span></span><br></pre></td></tr></table></figure>
<p>在 class 组件中，如果想要修改 context 的值，我们会使用 <code>Provider</code> 提供 value 值，同样，在 function 组件中也可以：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(<span class="string">'🇨🇳'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Context</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> local = useContext(ThemeContext)</span><br><span class="line">  <span class="keyword">return</span> &lt;p&gt;local: &#123;local&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ThemeContext.Provider value=&#123;'🇺🇸'&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Context /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/ThemeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ render: 🇺🇸</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Additional-Hooks"><a href="#Additional-Hooks" class="headerlink" title="Additional Hooks"></a>Additional Hooks</h2><h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><p><code>useReducer</code> 是 <code>useState</code> 的一种代替方案，用于 state 之间有依赖关系或者比较复杂的场景。<code>useReducer</code> 接收三个参数：</p>
<ul>
<li>reducer：<code>(state, action) =&gt; newState</code></li>
<li>initialArg： 初始化参数</li>
<li>Init： 惰性初始化,返回初始化数据</li>
</ul>
<p>返回当前 state 以及配套的 dispatch 方法。首先看下 <code>useReducer</code> 处理简单的 state：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseReducerDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, dispatch] = useReducer(<span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state + <span class="number">1</span></span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;count: &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          dispatch()</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        add</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个例子和使用 <code>useState</code> 一样，都达到了计数的效果。 该例子中，useReducer 初始化了 <code>count</code> 值为 0，传入的 reducer 很简单，当接收到一个 dispatch 时，将 <code>count</code> 的值增加 1。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useReducer" target="_blank" rel="noopener">demo</a></p>
<p>接下来我们看 <code>useReducer</code> 如何处理 state 有相互依赖的场景，还是从一个 demo 开始：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CountApp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [frozen, setFrozen] = useState(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> increase = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(<span class="function"><span class="params">prevCount</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (frozen) &#123;</span><br><span class="line">        <span class="keyword">return</span> prevCount</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> prevCount + <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    increase()</span><br><span class="line">    setFrozen(<span class="literal">true</span>)</span><br><span class="line">    increase()</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;p&gt;count &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>在副作用中，我们执行 <code>increase</code> 先将 <code>count</code> 的值增加 1，然后执行 <code>setFrozen</code> 将 <code>count</code> 的值 “冻住”，再执行 <code>increase</code> 将 <code>count</code> 的值增加 1，由于在 <code>setCount</code> 进行了判断，如果 <code>frozen</code> 为 <code>true</code>，则直接返回，否则增加 1，按照这样的思路，最后 count 的值应该为 1，但是事实上屏幕输出的是 2，为什么会出现这样的结果？<a href="https://kuangpf.com/react-hooks-demo/#/useReducer-useState/stateCount-v1" target="_blank" rel="noopener">demo</a></p>
<p>原因在于 function 组件的更新机制，当引入 hooks 以后，function 组件也拥有了 state 的功能，当我们 <code>setState</code> 时，UI 会重新渲染，但在这个过程中，有一点需要我们注意是：<br><strong>function 组件中，state 以及 props 都是静态值，不存在引用，或者也可以理解为 state 和 props 是一个 capture value，每次渲染的 state 和 props 都是独立的。</strong></p>
<p>关于这点，可以查看 <a href="https://overreacted.io/a-complete-guide-to-useeffect" target="_blank" rel="noopener">a-complete-guide-to-useeffect</a> 了解更多。</p>
<p>在这个例子中，由于 <code>useEffect</code> 传入的依赖为 <code>[]</code>，即该副作用只会在 UI 第一次渲染结束后执行一次。而在这次 <code>render</code> 中，<code>count</code> 的值为 0， <code>frozen</code> 值为 <code>false</code>，所以第二次执行 <code>increase</code> 时，<code>frozen</code> 值依然为 <code>false</code>， <code>setCount</code> 返回的 <code>prevCount</code> 为 1 ，然后增加 1，这也就是为什么最后 <code>render</code> 的结果为 2，而不是 1。</p>
<p>对于 state 有相互依赖的情况，我们可以用 <code>useReducer</code> 来处理</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> INCREASE = <span class="string">'INCREASE'</span></span><br><span class="line"><span class="keyword">const</span> SET_FROZEN = <span class="string">'SET_FROZEN'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  count: <span class="number">0</span>,</span><br><span class="line">  frozen: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CountApp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reducer = <span class="function">(<span class="params">state: <span class="built_in">any</span>, action: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> INCREASE:</span><br><span class="line">        <span class="keyword">if</span> (state.frozen) &#123;</span><br><span class="line">          <span class="keyword">return</span> state</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          count: state.count + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> SET_FROZEN:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          frozen: action.frozen</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> [state, dispath] = useReducer(reducer, initialState)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispath(&#123; <span class="keyword">type</span>: INCREASE &#125;)</span><br><span class="line">    dispath(&#123; <span class="keyword">type</span>: SET_FROZEN, frozen: <span class="literal">true</span> &#125;)</span><br><span class="line">    dispath(&#123; <span class="keyword">type</span>: INCREASE &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;p&gt;current count: &#123;state.count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>当我们使用 <code>useReducer</code> 后，将 <code>count</code> 和 <code>frozen</code> 关联起来，执行 <code>dispath({ type: SET_FROZEN, frozen: true })</code> 修改了 <code>frozen</code> 值 ，紧接着执行 <code>dispath({ type: INCREASE })</code> 时，此时获取到的 <code>frozen</code> 值为 <code>true</code>，当然最后 <code>render</code> 结果就为 1 。<a href="https://kuangpf.com/react-hooks-demo/#/useReducer-useState/reducerCount-v1" target="_blank" rel="noopener">demo</a></p>
<p>前面说了 <code>useReducer</code> 是 <code>useState</code> 的一种代替方案，那么如何使用 <code>useState</code> 实现呢，思路一样，只要将 count 与 frozen 放在一个 state 中即可解决：<a href="https://kuangpf.com/react-hooks-demo/#/useReducer-useState/stateCount-v2" target="_blank" rel="noopener">demo</a></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CountApp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState(&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    frozen: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> increase = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (prevState.frozen) &#123;</span><br><span class="line">        <span class="keyword">return</span> prevState;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...prevState,</span><br><span class="line">        count: state.count + <span class="number">1</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setFrozen = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...prevState,</span><br><span class="line">        frozen: <span class="literal">true</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    increase();</span><br><span class="line">    setFrozen();</span><br><span class="line">    increase();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;p&gt;current count: &#123;state.count&#125;&lt;<span class="regexp">/p&gt;;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ render：1</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p><code>useReducer</code> 和 <code>useState</code> 相比，优势在于可以将使用 reducer 将一些逻辑进行抽离，进行集中化管理。</p>
<h3 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h3><p><code>useCallback</code> 可以理解为将函数进行了缓存，它接收一个回调函数和一个依赖数组，只有当依赖数组中的值发生改变时，该回调函数才会更新。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseCallbackDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleResize = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`the current count is: <span class="subst">$&#123;count&#125;</span>`</span>)</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, handleResize)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'resize'</span>, handleResize)</span><br><span class="line">  &#125;, [handleResize])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          setCount(count + <span class="number">1</span>)</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        click</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;current count: &#123;count&#125;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>该例子中，当改变 <code>count</code> 后，然后改变浏览器窗口大小，可以获取到最新的 <code>count</code> 。如果传入的依赖为 <code>[]</code>，handleResize 不会更新，则改变浏览器窗口时， <code>count</code> 的值始终为 0 。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useCallback" target="_blank" rel="noopener">demo</a></p>
<h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><p><code>useMemo</code> 对值进行了缓存，与 <code>useCallback</code> 类似，接收一个创建值的函数和一个依赖数组，它仅会在某个依赖项改变时才重新计算 memoized 值，这种优化有助于避免在每次渲染时都进行高开销的计算。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseMemoDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> useMemoChild = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &lt;Child count=&#123;count&#125; /&gt;, [count])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;&#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setCount(count + 1)</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        click</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;input value=&#123;value&#125; onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> setValue(e.target.value)&#125; /&gt;</span><br><span class="line">      &#123;useMemoChild&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Child(&#123; count &#125;: &#123; count: number &#125;) &#123;</span></span><br><span class="line"><span class="regexp">  console.log('child render')</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;Fragment&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;useMemo hooks&lt;/</span>p&gt;</span><br><span class="line">      &lt;p&gt;child count: &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Fragment&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该例子中，UseMemoDemo 组件引用了 Child 组件，在 UseMemoDemo 组件中，定义了 <code>count</code> 和 <code>value</code> 两个 state，如果不使用 <code>useMemo</code>，那么每当 UseMemoDemo 中 input 发生改变时，Child 组件就会重新渲染。但 Child 组件 UI 只和 <code>count</code> 有关，那么这样就会造成 Child 组件无效更新，因此就引入了 <code>useMemo</code>，将 <code>count</code> 作为依赖传入，这样只有当 <code>count</code> 值发生改变时， Child 组件才会重新渲染。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useMemo" target="_blank" rel="noopener">demo</a></p>
<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p><code>useRef</code> 返回一个可变的 ref 对象，其 <code>.current</code> 属性被初始化为传入的参数 <code>（initialValue）</code>。返回的 ref 对象在组件的整个生命周期内保持不变。在 function 组件中， 使用 <code>useRef</code> 主要可以完成以下两件事：</p>
<ul>
<li>获取 dom 结构</li>
<li>保存变量</li>
</ul>
<p>先看一个获取 dom 节点, 点击 button 时，input 聚焦。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useRef" target="_blank" rel="noopener">demo</a></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UseRefDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span> <span class="keyword">as</span> <span class="built_in">any</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleFocusInput = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    inputRef.current.focus()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input ref=&#123;inputRef&#125; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleFocusInput&#125;&gt;click focus&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后看一个 react hook 官方的一个 <a href="https://codesandbox.io/s/lyx20m1ol?file=/src/index.js" target="_blank" rel="noopener">demo</a></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>)</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;Click me&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>如果我们 3s 点多次点击 button，那么控制台输出的结果会是 0,1,2,3…， 这是由于每次渲染时 <code>count</code> 的值都是固定的。但类似的逻辑在 class 组件中表现不一样：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`You clicked <span class="subst">$&#123;this.state.count&#125;</span> times`</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 class 组件中，我们在 3s 内多次点击 button，最后在控制台输出的结果是最后一次 <code>count</code> 更新的值，那么如果使用 <code>useRef</code> 来实现这种效果？<br>前面说过 <code>useRef</code> 返回的对象在组件的整个生命周期内保持不变，它与自建一个 <code>{current: ...}</code> 对象的唯一区别是，<code>useRef</code> 会在每次渲染时返回同一个 ref 对象，那么我们可以这样处理：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRefDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> countRef = useRef(count)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    countRef.current = count</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`You clicked <span class="subst">$&#123;countRef.current&#125;</span> times`</span>)</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;count: &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setCount(count + 1)</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        click</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>每次渲染时，将 <code>count</code> 的值赋值给 <code>countRef.current</code>，由于 useRef 始终返回的是同一个对象，因此 <code>countRef.current</code> 始终是最新的 <code>count</code> 值，这种特性有点类似于 class 组件中的实例字段。</p>
<h3 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h3><p><code>useImperativeHandle</code> 可以让你在使用 ref 时，自定义暴露给父组件的实例值，在大多数情况下，应当避免使用 ref 这样的命令式代码。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyInput</span>(<span class="params">props, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span> <span class="keyword">as</span> <span class="built_in">any</span>)</span><br><span class="line">  useImperativeHandle(ref, <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    focus: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      inputRef.current.focus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="keyword">return</span> &lt;input ref=&#123;inputRef&#125; /&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyInputRef = forwardRef(FancyInput)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useImperativeHandleDemo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span> <span class="keyword">as</span> <span class="built_in">any</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    inputRef.current.focus()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;FancyInputRef ref=&#123;inputRef&#125; /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 useImperativeHandleDemo 中，调用 <code>inputRef.current.focus()</code> 让 input 聚焦。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useImperativeHandle" target="_blank" rel="noopener">demo</a></p>
<h3 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h3><p>其<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Signature/Function" target="_blank" rel="noopener">函数签名</a> 与 <code>useEffect</code> 相同，但它会在所有的 DOM 变更之后同步调用 effect。可以使用它来读取 DOM 布局并同步触发重渲染。在浏览器执行绘制之前，<code>useLayoutEffect</code> 内部的更新计划将被同步刷新。<br>看一个简单的例子：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BlinkyRender = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value === <span class="number">0</span>) &#123;</span><br><span class="line">      setValue(<span class="number">10</span> + <span class="built_in">Math</span>.random() * <span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> setValue(<span class="number">0</span>)&#125;&gt;value: &#123;value&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<p>当我们快速点击时，<code>value</code> 会发生随机变化，但 useEffect 是 UI 已经渲染到屏幕上以后才会执行，<code>value</code> 会先渲染为 0，然后在渲染成随机数，因此屏幕会出现闪烁。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useLayoutEffect" target="_blank" rel="noopener">demo</a><br><img src="https://user-images.githubusercontent.com/20694238/80691645-20392480-8b03-11ea-8a46-39de9ee5529c.gif" alt="useEffect"></p>
<p>在 <code>useLayoutEffect</code> 中修改 <code>value</code> 的值：<br> <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useLayoutEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="number">0</span>) &#123;</span><br><span class="line">    setValue(<span class="number">10</span> + <span class="built_in">Math</span>.random() * <span class="number">200</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, [value]);</span><br></pre></td></tr></table></figure></p>
<p>相比使用 <code>useEffect</code>,当点击 div，<code>value</code> 更新为 0，此时页面并不会渲染，而是等待 <code>useLayoutEffect</code> 内部状态修改后，才会去更新页面，所以页面不会闪烁。<a href="https://kuangpf.com/react-hooks-demo/#/additional/useLayoutEffect" target="_blank" rel="noopener">demo</a><br><img src="https://user-images.githubusercontent.com/20694238/80691814-58d8fe00-8b03-11ea-962f-7d4a5f417eb8.gif" alt="useLayoutEffect"></p>
<h3 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a>useDebugValue</h3><p><code>useDebugValue</code> 可用于在 React 开发者工具中显示自定义 hook 的标签,</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFriendStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [isOnline] = useState(<span class="literal">null</span>)</span><br><span class="line">  useDebugValue(isOnline ? <span class="string">'Online'</span> : <span class="string">'Offline'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isOnline</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = useFriendStatus()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;&#123;isOnline&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>在 React 开发者工具中会显示 “FriendStatus: Offline”<br><img src="https://user-images.githubusercontent.com/20694238/80696639-3f878000-8b0a-11ea-8e2f-a55fb7c66044.png" alt="useDebugValue"><br>在某些情况下，格式化值的显示可能是一项开销很大的操作，因此，<code>useDebugValue</code> 接受一个格式化函数作为可选的第二个参数。该函数只有在 Hook 被检查（打开 React 开发者工具）时才会被调用。它接受 debug 值作为参数，并且会返回一个格式化的显示值。<br>例如， 一个返回 <code>Date</code> 值的自定义 Hook 可以通过格式化函数来避免不必要的 <code>toDateString</code> 函数调用:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useDebugValue(date, <span class="function"><span class="params">date</span> =&gt;</span> date.toDateString());</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这篇文章将 React Hooks 语法进行了简单介绍，Hooks 功能十分强大，如果看完文章还不是很理解的话，建议把这些 demo 自己再手动实现一遍，这样收获会更多。如果文章内容有哪些描述错误或者不清的地方，欢迎各位纠正并一起交流。👏👏</p>

</article>
<a href="https://github.com/KuangPF/blog/issues/16" class="issues-link" target="_blank">
  问题讨论区
</a>

<div class="pagenator post-pagenator">
  
  <a class="extend prev post-prev" href="/blog/2020/05/04/why-react-hooks/">上一篇</a>
  

  <p>上次更新 2020-05-04</p>

  
  <a class="extend next post-next" href="/blog/2019/10/12/typescript-is-keyword/">下一篇</a>
  
</div>


    </div>
    <script src="https://unpkg.com/medium-zoom@1.0.4/dist/medium-zoom.min.js"></script>
    <script>
        let mediumZoomList = [...document.getElementsByTagName('img')].reduce((zoomList,currentItem)=> {
            return (currentItem.getAttribute('class') || []).indexOf('no-medium-zoom-image') >-1 ? zoomList : [...zoomList, currentItem]
        },[])
        mediumZoom(mediumZoomList)
    </script>
</body>
</html>
